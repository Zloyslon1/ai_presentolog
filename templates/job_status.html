{% extends "base.html" %}

{% block title %}Job Status - {{ job.id }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏</h1>
        
        <!-- Status Card -->
        <div class="border-l-4 p-4 mb-6 {% if job.status == 'completed' %}border-green-500 bg-green-50{% elif job.status == 'error' %}border-red-500 bg-red-50{% else %}border-yellow-500 bg-yellow-50{% endif %}">
            <div class="flex items-center mb-2">
                {% if job.status == 'processing' %}
                <div class="processing-spinner border-4 border-gray-200 rounded-full w-6 h-6 mr-3"></div>
                <span class="font-semibold text-lg">–û–±—Ä–∞–±–æ—Ç–∫–∞...</span>
                {% elif job.status == 'completed' %}
                <span class="text-2xl mr-2">‚úÖ</span>
                <span class="font-semibold text-lg text-green-800">–ì–æ—Ç–æ–≤–æ!</span>
                {% else %}
                <span class="text-2xl mr-2">‚ùå</span>
                <span class="font-semibold text-lg text-red-800">–û—à–∏–±–∫–∞</span>
                {% endif %}
            </div>
            
            {% if job.status == 'processing' %}
            <p class="text-sm text-gray-700">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã...</p>
            {% elif job.status == 'completed' %}
            <p class="text-sm text-green-700">–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞!</p>
            {% else %}
            <p class="text-sm text-red-700">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ</p>
            {% endif %}
        </div>

        <!-- Job Details -->
        <dl class="grid grid-cols-1 gap-4 mb-6">
            <div class="bg-gray-50 p-4 rounded">
                <dt class="text-sm font-medium text-gray-500">ID –∑–∞–¥–∞—á–∏</dt>
                <dd class="mt-1 text-sm text-gray-900 font-mono">{{ job.id }}</dd>
            </div>
            
            <div class="bg-gray-50 p-4 rounded">
                <dt class="text-sm font-medium text-gray-500">–®–∞–±–ª–æ–Ω</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ job.template }}</dd>
            </div>
            
            <div class="bg-gray-50 p-4 rounded">
                <dt class="text-sm font-medium text-gray-500">–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ job.created_at }}</dd>
            </div>
            
            {% if job.completed_at %}
            <div class="bg-gray-50 p-4 rounded">
                <dt class="text-sm font-medium text-gray-500">–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ job.completed_at }}</dd>
            </div>
            {% endif %}
        </dl>

        <!-- Result -->
        {% if job.status == 'completed' and job.result %}
        <div class="border-t pt-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg mb-4">
                <p class="text-sm text-gray-600 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ:</p>
                <p class="text-lg font-semibold text-gray-900 mb-4">{{ job.result.title }}</p>
                
                <div class="flex gap-3">
                    <a href="{{ job.result.presentation_url }}" 
                       target="_blank"
                       class="inline-flex items-center px-6 py-3 text-white bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 rounded-lg font-medium">
                        <span class="mr-2">üé®</span>
                        –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é
                    </a>
                    
                    <a href="/slide_editor?job_id={{ job.id }}" 
                       class="inline-flex items-center px-6 py-3 text-purple-700 bg-white border-2 border-purple-500 hover:bg-purple-50 rounded-lg font-medium">
                        <span class="mr-2">‚úèÔ∏è</span>
                        –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
                    </a>
                </div>
            </div>
            
            <div class="text-sm text-gray-500">
                <p class="mb-2">üí° –°–æ–≤–µ—Ç: –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –≤–∞—à–µ–º Google Drive —Å –∏–º–µ–Ω–µ–º "{{ job.result.title }}"</p>
                <p>–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –µ—ë –∫–∞–∫ PowerPoint –∏–ª–∏ PDF —á–µ—Ä–µ–∑ –º–µ–Ω—é –§–∞–π–ª ‚Üí –°–∫–∞—á–∞—Ç—å</p>
                <p class="mt-2 font-semibold text-purple-600">‚ú® –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç—É –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é!</p>
            </div>
        </div>
        {% endif %}

        <!-- Error -->
        {% if job.status == 'error' and job.error %}
        <div class="border-t pt-6">
            <h2 class="text-xl font-bold text-red-900 mb-4">–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏</h2>
            <div class="bg-red-50 border border-red-200 rounded p-4">
                <pre class="text-sm text-red-800 whitespace-pre-wrap">{{ job.error }}</pre>
            </div>
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="border-t pt-6 mt-6">
            <div class="flex gap-4">
                <a href="/" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
                {% if job.status == 'error' %}
                <a href="/" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if job.status == 'processing' %}
<!-- Auto-refresh for processing jobs -->
<script>
    setTimeout(function() {
        location.reload();
    }, 3000); // Refresh every 3 seconds
</script>
{% endif %}
{% endblock %}
